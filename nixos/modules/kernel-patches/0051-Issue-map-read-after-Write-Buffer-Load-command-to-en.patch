From 4575feb6cb9d44a15acdb66dba1d0e7f2b6f2c9e Mon Sep 17 00:00:00 2001
From: George Kashperko <george@znau.edu.ua>
Date: Tue, 27 Sep 2022 16:21:39 +0200
Subject: [PATCH 51/96] Issue map read after Write Buffer Load command to
 ensure chip is ready to receive data.

Signed-off-by: George Kashperko <george@znau.edu.ua>
---
 drivers/mtd/chips/cfi_cmdset_0002.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/mtd/chips/cfi_cmdset_0002.c b/drivers/mtd/chips/cfi_cmdset_0002.c
index a6692d72f24b..13694138a8b8 100644
--- a/drivers/mtd/chips/cfi_cmdset_0002.c
+++ b/drivers/mtd/chips/cfi_cmdset_0002.c
@@ -2052,6 +2052,7 @@ static int __xipram do_write_buffer(struct map_info *map, struct flchip *chip,
 
 	/* Write Buffer Load */
 	map_write(map, CMD(0x25), cmd_adr);
+	(void) map_read(map, cmd_adr);
 
 	chip->state = FL_WRITING_TO_BUFFER;
 
-- 
2.37.2

